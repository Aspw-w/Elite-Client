package com.instrumentalist.elite.hacks.features.exploit;

import com.instrumentalist.elite.events.features.ModifyPacketEvent;
import com.instrumentalist.elite.events.features.SendPacketEvent;
import com.instrumentalist.elite.events.features.WorldEvent;
import com.instrumentalist.elite.hacks.Module;
import com.instrumentalist.elite.hacks.ModuleCategory;
import com.instrumentalist.elite.hacks.ModuleManager;
import com.instrumentalist.elite.utils.ChatUtil;
import com.instrumentalist.elite.utils.packet.PacketUtil;
import com.instrumentalist.elite.utils.value.BooleanValue;
import com.instrumentalist.elite.utils.value.TextValue;
import net.minecraft.network.packet.BrandCustomPayload;
import net.minecraft.network.packet.Packet;
import net.minecraft.network.packet.UnknownCustomPayload;
import net.minecraft.network.packet.c2s.common.CustomPayloadC2SPacket;
import org.lwjgl.glfw.GLFW;

public class VanillaSpoofer extends Module {

    public VanillaSpoofer() {
        super("Vanilla Spoofer", ModuleCategory.Exploit, GLFW.GLFW_KEY_UNKNOWN, true, true);
    }

    private final BooleanValue customBrand = new BooleanValue("Custom Brand", false);

    private final TextValue brandString = new TextValue("Brand String", "NerdClient", customBrand::get);

    private boolean spoofed = false;

    @Override
    public void onDisable() {
        spoofed = false;
    }

    @Override
    public void onEnable() {
    }

    @Override
    public void onWorld(WorldEvent event) {
        if (spoofed) {
            String fakerString = customBrand.get() ? brandString.get() : "vanilla";
            ChatUtil.printChat("Spoofed client brand to \"" + fakerString + "\"");
            spoofed = false;
        }
    }

    @Override
    public void onModifyPacket(ModifyPacketEvent event) {
        Packet<?> packet = event.packet;

        if (packet instanceof CustomPayloadC2SPacket && ((CustomPayloadC2SPacket) packet).payload() instanceof BrandCustomPayload) {
            String fakerString = customBrand.get() ? brandString.get() : "vanilla";
            event.packet = new CustomPayloadC2SPacket(new BrandCustomPayload(fakerString));
            spoofed = true;
        }
    }
}

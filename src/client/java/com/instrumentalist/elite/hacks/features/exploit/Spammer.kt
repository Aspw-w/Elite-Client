package com.instrumentalist.elite.hacks.features.exploit

import com.instrumentalist.elite.events.features.UpdateEvent
import com.instrumentalist.elite.hacks.Module
import com.instrumentalist.elite.hacks.ModuleCategory
import com.instrumentalist.elite.utils.IMinecraft
import com.instrumentalist.elite.utils.math.MSTimer
import com.instrumentalist.elite.utils.math.RandomUtil
import com.instrumentalist.elite.utils.value.BooleanValue
import com.instrumentalist.elite.utils.value.IntValue
import com.instrumentalist.elite.utils.value.TextValue
import org.lwjgl.glfw.GLFW

class Spammer : Module("Spammer", ModuleCategory.Exploit, GLFW.GLFW_KEY_UNKNOWN, false, true) {
    private val message = TextValue("Message", "cocaine")

    private val delay = IntValue("Delay", 1010, 0, 3000)

    private val randomSuffix = BooleanValue("Random Suffix", true)

    private val partyChatMode = BooleanValue("Party Chat Mode", false)

    private val delayTimer = MSTimer()

    override fun onDisable() {}
    override fun onEnable() {}

    override fun onUpdate(event: UpdateEvent) {
        if (IMinecraft.mc.player == null) return

        if (delayTimer.hasTimePassed(delay.get().toLong())) {
            if (partyChatMode.get()) {
                if (randomSuffix.get())
                    IMinecraft.mc.player!!.networkHandler.sendChatCommand("pc ${message.get()} ${RandomUtil.randomString(3)}")
                else IMinecraft.mc.player!!.networkHandler.sendChatCommand("pc ${message.get()}")
            } else {
                if (message.get().startsWith("/")) {
                    val clearMessage = message.get().drop(1)
                    if (randomSuffix.get())
                        IMinecraft.mc.player!!.networkHandler.sendChatCommand("$clearMessage ${RandomUtil.randomString(3)}")
                    else IMinecraft.mc.player!!.networkHandler.sendChatCommand(clearMessage)
                } else {
                    if (randomSuffix.get())
                        IMinecraft.mc.player!!.networkHandler.sendChatMessage("${message.get()} ${RandomUtil.randomString(3)}")
                    else IMinecraft.mc.player!!.networkHandler.sendChatMessage(message.get())
                }
            }
            delayTimer.reset()
        }
    }
}

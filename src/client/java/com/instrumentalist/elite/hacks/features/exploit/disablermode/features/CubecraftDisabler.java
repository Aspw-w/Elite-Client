package com.instrumentalist.elite.hacks.features.exploit.disablermode.features;

import com.instrumentalist.elite.events.features.*;
import com.instrumentalist.elite.hacks.features.exploit.Disabler;
import com.instrumentalist.elite.hacks.features.exploit.disablermode.DisablerEvent;
import com.instrumentalist.elite.utils.ChatUtil;
import com.instrumentalist.elite.utils.IMinecraft;
import com.instrumentalist.elite.utils.move.MovementUtil;
import com.instrumentalist.elite.utils.packet.PacketUtil;
import net.minecraft.entity.Entity;
import net.minecraft.network.packet.Packet;
import net.minecraft.network.packet.c2s.common.CommonPongC2SPacket;
import net.minecraft.network.packet.c2s.play.PlayerInputC2SPacket;
import net.minecraft.network.packet.c2s.play.PlayerMoveC2SPacket;
import net.minecraft.network.packet.s2c.play.PlayerRespawnS2CPacket;
import net.minecraft.util.PlayerInput;

public class CubecraftDisabler implements DisablerEvent {

    @Override
    public String getName() {
        return "Cubecraft";
    }

    public static int godTick = 0;

    @Override
    public void onUpdate(UpdateEvent event) {
    }

    @Override
    public void onMotion(MotionEvent event) {
        if (IMinecraft.mc.player == null || IMinecraft.mc.player.age <= 20) return;

        if (godTick == 0 && IMinecraft.mc.player.age % 80 == 0)
            ChatUtil.printChat("Disabler hook failed");
    }

    @Override
    public void onTick(TickEvent event) {
    }

    @Override
    public void onAttack(AttackEvent event) {
        if (IMinecraft.mc.player == null || IMinecraft.mc.player.age <= 20) return;

        Entity target = event.entity;

        if (target != IMinecraft.mc.player && (IMinecraft.mc.player.distanceTo(target) >= 3f || godTick >= 3 && (godTick >= 328 || godTick <= 5)))
            event.cancel();
    }

    @Override
    public void onSendPacket(SendPacketEvent event) {
        if (IMinecraft.mc.player == null || IMinecraft.mc.player.age <= 20) return;

        Packet<?> packet = event.packet;

        if (godTick == 1) {
            ChatUtil.printChat("Sentinel bypasses has activated");
            godTick++;
        }

        if (godTick >= 3) {
            if (packet instanceof PlayerInputC2SPacket) {
                event.cancel();
                PacketUtil.sendPacketAsSilent(new PlayerInputC2SPacket(new PlayerInput(false, false, false, false, false, false, false)));
            }
            if ((godTick >= 328 || godTick <= 5) && packet instanceof PlayerMoveC2SPacket)
                event.cancel();
            else if (godTick % 55 == 0)
                PacketUtil.sendPacketAsSilent(new PlayerMoveC2SPacket.OnGroundOnly(true, IMinecraft.mc.player.horizontalCollision));
        }

        if (packet instanceof CommonPongC2SPacket) {
            int parameter = ((CommonPongC2SPacket) packet).getParameter();
            if (parameter < 0 && (godTick >= 3 || godTick == 0)) {
                godTick++;
                PacketUtil.sendPacketAsSilent(new CommonPongC2SPacket(parameter + 1));
            } else if (parameter != 0) {
                event.cancel();
                if (godTick >= 330 || godTick == 2) {
                    PacketUtil.sendPacketAsSilent(new CommonPongC2SPacket(parameter + 3));
                    godTick = 3;
                }
            }
        }
    }

    @Override
    public void onReceivedPacket(ReceivedPacketEvent event) {
        Packet<?> packet = event.packet;

        if (packet instanceof PlayerRespawnS2CPacket)
            godTick = 0;
    }

    @Override
    public void onWorld(WorldEvent event) {
        godTick = 0;
    }
}